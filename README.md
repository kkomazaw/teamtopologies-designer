# Team Topologies Designer

Team Topologiesの理論に基づいて、組織構造を視覚的に設計・管理できるWebベースのダッシュボードアプリケーションです。

## 特徴

- **4つのチームタイプをサポート**
  - Stream-Aligned Team（ストリームアラインドチーム）
  - Enabling Team（イネーブリングチーム）
  - Complicated-Subsystem Team（複雑なサブシステムチーム）
  - Platform Team（プラットフォームチーム）

- **3つのインタラクションモード**
  - Collaboration（コラボレーション）
  - X-as-a-Service（サービス提供）
  - Facilitating（ファシリテーション）

- **ビジュアルエディタ**
  - ドラッグ&ドロップでチームを配置
  - React Flowによる直感的な操作
  - チーム間の接続を簡単に作成

- **データ管理**
  - JSON形式での保存・読込
  - ブラウザLocalStorageへの自動保存（予定）
  - Team API情報の管理

## 技術スタック

- **フレームワーク**: Next.js 15 (App Router)
- **UIライブラリ**: React 19
- **言語**: TypeScript
- **スタイリング**: Tailwind CSS
- **グラフ描画**: React Flow (@xyflow/react)
- **状態管理**: Zustand
- **ユーティリティ**: nanoid, clsx, tailwind-merge

## セットアップ

### 前提条件

- Node.js 18.x以上
- npm または pnpm

### インストール

```bash
# 依存関係のインストール
npm install

# 開発サーバーの起動
npm run dev
```

開発サーバーは http://localhost:3000 で起動します。

## 使い方

### 1. チームの作成

1. 左側のサイドバーから4つのチームタイプのいずれかを選択
2. キャンバス（中央のエリア）にドラッグ&ドロップ
3. チームがキャンバス上に配置されます

### 2. チームの配置

- チームをドラッグして自由に配置できます
- キャンバスはパン・ズーム可能（マウスホイールやミニマップを使用）

### 3. インタラクションの作成と編集

**作成:**
1. チームノードの下部のハンドルをクリック
2. 別のチームノードの上部のハンドルまでドラッグ
3. インタラクション（エッジ）が作成されます

**編集:**
1. エッジ（線）をクリック
2. 右側にインタラクションプロパティパネルが表示
3. インタラクションモードを変更（Collaboration, X-as-a-Service, Facilitating）
4. ラベルや説明を追加

### 4. チームの編集

1. キャンバス上のチームをクリック
2. 右側にプロパティパネルが表示されます
3. 3つのタブから編集する内容を選択：
   - **Basic Info**: チーム名、タイプ、説明、メンバー数、技術スタック、責任範囲、タグ
   - **Team API**: 公式Team Topologiesテンプレートに基づくチーム情報（詳細は下記）
   - **Cognitive Load**: 認知負荷の評価（ドメイン・技術・責任範囲の複雑性）
4. 変更は自動的に保存されます（フィールドからフォーカスが外れた時）

#### Team APIタブの使い方

Team APIタブは、公式の[Team API template](https://github.com/TeamTopologies/Team-API-template)に基づいており、3つのサブタブで構成されています：

**Basic Infoサブタブ:**
- チームフォーカス: チームが注力している領域
- プラットフォームの一部か: チームがプラットフォームに所属している場合にチェック
- 他チームへのサービス提供: 他チームにサービスを提供している場合にチェック
- サービスレベル期待値（SLE）: 稼働率、レスポンス時間などの期待値
- 管理するソフトウェア: チームが所有・進化させているソフトウェア（カンマ区切り）
- バージョニング手法: 使用しているバージョニング方式
- Wiki検索キーワード: Wikiでチーム情報を検索する際のキーワード
- チャットチャンネル: チームのSlack/Teamsなどのチャンネル名
- デイリーシンク時刻: 日次ミーティングの時刻

**Current Workサブタブ:**
- サービス・システム: 現在取り組んでいるサービスやシステム（1行1項目）
- 作業方法: チーム内プロセスの改善活動（1行1項目）
- 組織横断的改善: より広範な組織改善への貢献（1行1項目）

**Interactionsサブタブ:**
- 現在のインタラクション: 他チームとの現在の協働関係を管理
- 計画中のインタラクション: 近日中に予定されているチーム間の協働を管理
- 各インタラクションで以下を設定:
  - 相手チーム
  - インタラクションモード（Collaboration / X-as-a-Service / Facilitating）
  - 目的
  - 期間（例: "継続中"、"3ヶ月"、"Q2まで"）

### 5. トポロジーのエクスポート

1. ヘッダーの「Export ▾」ボタンをクリック
2. 希望する形式を選択：
   - **Export as JSON**: JSON形式でエクスポート
   - **Export as YAML**: YAML形式でエクスポート
   - **Export as CSV (ZIP)**: 5つのCSVファイルをZIPで一括ダウンロード

### 6. トポロジーのインポート

**JSON/YAML形式:**
1. ヘッダーの「Import ▾」ボタンをクリック
2. 「Import from JSON/YAML」を選択
3. 保存したJSON/YAMLファイルを選択
4. トポロジーが読み込まれます

**CSV形式（ZIP）:**
1. ヘッダーの「Import ▾」ボタンをクリック
2. 「Import from CSV (ZIP)」を選択
3. インポートモードを選択：
   - **Replace**: 既存のすべてのチームとインタラクションを削除して、インポートしたデータで置換
   - **Merge**: 既存データを保持したまま、インポートしたデータを追加
4. ZIPファイルを選択（teams.csv, services.csv, dependencies.csv, interactions.csv, repositories.csvを含む）
5. データが検証され、エラーや警告があれば表示されます
6. インポートが成功するとトポロジーが更新されます

### 7. 自動保存

- チームやインタラクションの変更は自動的にLocalStorageに保存されます
- ブラウザをリロードしても、前回の作業内容が復元されます

### 8. チームの検索とフィルタリング

多くのチームがある場合、検索・フィルタ機能が便利です：

**検索:**
1. サイドバーの「Search & Filter」セクションの検索ボックスを使用
2. チーム名、説明、技術スタック、責任範囲で検索可能
3. 検索結果はリアルタイムで表示されます

**チームタイプでフィルタ:**
1. 「Type」セクションでチームタイプのチェックボックスを選択
2. 複数のタイプを同時に選択可能
3. 選択したタイプのチームのみが表示されます

**タグでフィルタ:**
1. 「Tag」ドロップダウンからタグを選択
2. 選択したタグを持つチームのみが表示されます

**ビジュアルフィードバック:**
- フィルタリングされたチームは通常表示
- フィルタリングされていないチームとインタラクションは薄く表示（30%の不透明度）
- スムーズなアニメーションで切り替わります

**フィルタのクリア:**
- 「Clear Filters」ボタンをクリックしてすべてのフィルタをリセット

### 9. キーボードショートカット

便利なショートカットキーで効率的に作業できます：

| ショートカット | 機能 |
|--------------|------|
| `Delete` / `Backspace` | 選択中のチーム/インタラクションを削除 |
| `Escape` | 選択解除 |
| `Cmd/Ctrl + S` | トポロジーをJSON形式で保存 |
| `Cmd/Ctrl + N` | 新規トポロジーを作成 |

## 現在の実装状況

### ✅ Phase 1: MVP - 完了

- [x] Next.jsプロジェクトのセットアップ
- [x] TypeScript型定義（データモデル）
- [x] Zustandストア（状態管理）
- [x] 基本レイアウト（Header, Sidebar, Canvas）
- [x] React Flow統合
- [x] 4つのチームタイプのノードコンポーネント
- [x] ドラッグ&ドロップでチーム作成
- [x] チーム間のインタラクション作成
- [x] JSON形式での保存・読込

### ✅ Phase 2: データ管理 - 完了

- [x] プロパティパネル（チーム編集UI）
  - チーム名、説明、メンバー数の編集
  - チームタイプの変更
  - 技術スタック、責任範囲、タグの管理
  - チーム削除機能
- [x] YAML形式対応（エクスポート）
- [x] CSV形式対応（エクスポート）
  - teams.csv, services.csv, dependencies.csv, interactions.csv, repositories.csv
  - ZIP形式での一括ダウンロード
- [x] LocalStorageへの自動保存
  - 500msのデバウンスによる自動保存
  - ページリロード時の自動復元

### ✅ Phase 3: ビジュアル強化 & UX改善 - 完了

- [x] インタラクション編集UI
  - エッジ（インタラクション）をクリックして編集
  - 3つのインタラクションモードを視覚的に選択
  - ラベルと説明の編集
  - インタラクション削除機能
- [x] エッジの視覚的差別化
  - Collaboration: 太い双方向線（グレー）
  - X-as-a-Service: アニメーション付き矢印（ブルー）
  - Facilitating: 点線矢印（グリーン）
  - エッジラベル表示
- [x] チームリスト表示
  - サイドバーに全チームのリスト
  - チームタイプ別の色分け
  - クリックでチーム選択
- [x] キーボードショートカット
  - `Delete/Backspace`: 選択中のチーム/インタラクションを削除
  - `Escape`: 選択解除
  - `Cmd/Ctrl + S`: トポロジーを保存
  - `Cmd/Ctrl + N`: 新規トポロジー作成

### ✅ Phase 4: Team API詳細管理 - 完了

- [x] プロパティパネルのタブインターフェース
  - Basic Info, Team API, Cognitive Loadの3タブ構成
- [x] Team API - 公式テンプレートに基づく実装
  - 参考: [Team Topologies 公式 Team API テンプレート](https://github.com/TeamTopologies/Team-API-template)
  - **Basic Infoタブ**
    - チームフォーカス、プラットフォーム所属情報
    - 他チームへのサービス提供情報
    - サービスレベル期待値（SLE）
    - 管理するソフトウェア、バージョニング手法
    - Wiki検索キーワード、チャットチャンネル
    - デイリーシンク時刻
  - **Current Workタブ**
    - サービス・システムへの取り組み
    - チーム内作業方法の改善
    - 組織横断的な改善活動
  - **Interactionsタブ**
    - 現在のチーム間インタラクション管理
    - 計画中のチーム間インタラクション管理
    - インタラクションモード、目的、期間の設定
- [x] 認知負荷指標の編集UI
  - ドメイン複雑性、技術複雑性、責任範囲の3指標
  - スライダーによる1-10の評価
  - 総合認知負荷の自動計算と視覚化
  - 高負荷時の警告と改善提案表示

### ✅ Phase 5: CSVインポート機能 - 完了

- [x] ZIPファイルからのインポート
  - ZIPファイルのアップロードUI
  - 5つのCSVファイル（teams, services, dependencies, interactions, repositories）の解析
- [x] データバリデーション
  - 必須フィールドのチェック
  - チームタイプとインタラクションモードの検証
  - チームID参照の整合性確認
  - エラーと警告の表示
- [x] マージ/置換モード選択
  - Replace: 既存データを完全に置換
  - Merge: 既存データに新規データを追加
- [x] インポートモーダルUI
  - モード選択ラジオボタン
  - ファイルアップロード
  - エラー・警告メッセージ表示
  - インポート進捗表示

### ✅ Phase 6: 検索・フィルタ機能 - 完了

- [x] サイドバーに検索UI
  - チーム名、説明、技術スタック、責任範囲での検索
  - リアルタイム検索結果の表示
- [x] チームタイプフィルタ
  - 4つのチームタイプ（Stream-Aligned、Enabling、Complicated-Subsystem、Platform）でのフィルタリング
  - 複数タイプの同時選択可能
- [x] タグフィルタ
  - チームに設定されたタグでのフィルタリング
  - ドロップダウンで選択
- [x] キャンバス上のビジュアルフィードバック
  - フィルタリングされたチームをハイライト表示
  - フィルタリングされていないチームとインタラクションを薄く表示（opacity: 0.3）
  - スムーズなトランジションアニメーション
- [x] フィルタのクリア機能
  - ワンクリックですべてのフィルタをリセット
- [x] チーム数の表示
  - フィルタリング結果の件数表示（例: Teams 3/10）

### 🚧 未実装（今後の実装予定）

#### Phase 7: 追加機能
- [ ] 自動レイアウト機能
- [ ] Undo/Redo機能
- [ ] ダークモード対応

#### Phase 8: 分析・出力機能
- [ ] チーム依存関係の分析ダッシュボード
- [ ] PNG/SVG画像エクスポート
- [ ] Mermaid/PlantUML出力
- [ ] PDF レポート生成

## プロジェクト構造

```
teamtopologies-designer/
├── src/
│   ├── app/              # Next.js App Router
│   │   ├── globals.css   # グローバルスタイル
│   │   ├── layout.tsx    # ルートレイアウト
│   │   └── page.tsx      # トップページ
│   ├── components/       # Reactコンポーネント
│   │   ├── canvas/       # キャンバス関連
│   │   ├── layout/       # レイアウト関連（Header, Sidebar）
│   │   ├── team-node/    # チームノードコンポーネント
│   │   └── topology-designer.tsx  # メインコンポーネント
│   ├── lib/             # ユーティリティとヘルパー
│   │   ├── constants.ts # 定数定義
│   │   └── utils.ts     # ユーティリティ関数
│   ├── store/           # Zustand状態管理
│   │   └── topology-store.ts
│   └── types/           # TypeScript型定義
│       └── team.ts
├── requirements.md      # 要件定義書
├── package.json
├── tsconfig.json
├── tailwind.config.ts
└── next.config.ts
```

## ライセンス

MIT

## 参考資料

- [Team Topologies 公式サイト](https://teamtopologies.com/)
- [Team Topologies 書籍](https://teamtopologies.com/book)
- [Next.js ドキュメント](https://nextjs.org/)
- [React Flow ドキュメント](https://reactflow.dev/)

## 開発ロードマップ

詳細な開発ロードマップと要件定義は `requirements.md` を参照してください。

---

**現在のバージョン**: 1.7.0 (多言語対応: 英語・日本語)

**最終更新**: 2026-01-06

## 多言語対応

アプリケーションは英語と日本語の2ヶ国語に対応しています：
- ヘッダー右上の言語切り替えドロップダウンから言語を選択できます
- URL: `/ja/` (日本語) または `/en/` (英語)
- ブラウザの言語設定に基づいて自動的に適切な言語が選択されます
